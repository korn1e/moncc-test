version: 2.1
jobs:
  deploy:
    docker:
      - image: gcr.io/moncc-public-gcr/moncc-ci:latest
    steps: 
      - checkout
      - run:
          command: |
            MNCC="mncc -s /var/run/monccd.sock --nofancy --nocolor"
            sleep 10
            $MNCC login --email aji_perdana@yahoo.com --password Rahasia0~123
            sleep 10
            $MNCC cluster switch -m H4sIAAAAAAAA/6zRwUrDQBDG8RfSmZ3NkGSPhWLFaMlqg10PQrq1cVMim3RTUfLw4kERFKRtbnP68f8Y3egqW11zZwqzs8sw3eb1ZUybt9e4vCmU68r7Jm1N9Dy98s3DQG1hskFjqPcGH4d4QC/9uXWd7V34vPEw8AydZySZgAABhMF6ZBaCjreUBIpTIGA1Bved1q+/rLZ3dpy+sUwBJFMQIKNfk1fVe7jYLULv0kqXMz/ZTJ722fZlfVsvteLG5mF+ly9mNM/y/75xhPWj7M+xp+SNBEYMiQRWQIk8afJHAAAA//+hJ6MXTAMAAA==
            sleep 60
            $MNCC load postgres.yaml
            sleep 10
            $MNCC cluster peers
            $MNCC run -t pg postgres/latest
            sleep 10
            $MNCC update postgres/latest
workflows:
  build:
    jobs:
      - deploy
