version: 2.1
jobs:
  deploy:
    docker:
      - image: gcr.io/moncc-public-gcr/moncc-ci:latest
    steps: 
      - checkout
      - run:
          command: |
            MNCC="mncc -s /var/run/monccd.sock --nofancy --nocolor"
            sleep 10
            $MNCC login --email aji_perdana@yahoo.com --password Rahasia0~123
            sleep 10
            $MNCC cluster switch -m H4sIAAAAAAAA/6zR0UrDMBTG8RfSk5w0tM3lYDixOhpdcfFC6DJX01E57dKJkof3QhQRL1zbF/jx5/t0o6tscy07U5iDXfv5Pq8vY9y9vcblTaFcV943aWui5/kVNQ8B28JkQTNfHw17DHFgjiRDkQAHDsi8JSYl58hIEDsNP/u0lACMU0CQagruO63ffllt7+w0fROYJOjcus72zg9v4oAiBQ4i+jtpU737i8PK9y6tdLmg2W72dMz2L9vbeq2VbGzul3f5aoHLLP/XbgPAH42/bx2TN96KJCQCpAJMxCjuIwAA//8pF8qZTAMAAA==
            sleep 60
            $MNCC load postgres.yaml
            sleep 10
            $MNCC cluster peers
            $MNCC run -t pg postgres/latest
            sleep 10
            $MNCC update postgres/latest
workflows:
  build:
    jobs:
      - deploy
